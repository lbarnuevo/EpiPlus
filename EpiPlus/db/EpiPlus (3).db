BEGIN TRANSACTION;
CREATE TABLE IF NOT EXISTS "emergencycontact" (
	"id"	INTEGER UNIQUE,
	"name"	TEXT NOT NULL,
	"number"	INTEGER NOT NULL,
	"patientId"	INTEGER NOT NULL,
	FOREIGN KEY("patientId") REFERENCES "patients"("id") ON DELETE SET NULL
);
CREATE TABLE IF NOT EXISTS "patients" (
	"id"	INTEGER PRIMARY KEY AUTOINCREMENT,
	"name"	TEXT NOT NULL,
	"age"	INTEGER NOT NULL,
	"height"	REAL,
	"weight"	REAL,
	"lifestyle"	TEXT CHECK("lifestyle" IN ("sedentary","little activity","moderate activity","high activity")),
	"diet"	TEXT CHECK("diet" IN ("mediterranean","high protein","gluten free","lactose free","dairy free","keto diet","highly caloric","caloric deficit","vegan","vegetarian","intermitent fasting")),
	"ex_per_week"	INTEGER,
	"doctorId"	INTEGER,
	"photo"	BLOB,
	"emergency_contact"	NUMERIC,
	FOREIGN KEY("doctorId") REFERENCES "doctors"("id") ON DELETE SET NULL
);
CREATE TABLE IF NOT EXISTS "medications" (
	"id"	INTEGER PRIMARY KEY AUTOINCREMENT,
	"name"	TEXT NOT NULL
);
CREATE TABLE IF NOT EXISTS "episodes" (
	"id"	INTEGER PRIMARY KEY AUTOINCREMENT,
	"date"	date NOT NULL,
	"length"	REAL NOT NULL,
	"activity"	TEXT,
	"mood"	TEXT,
	"place"	TEXT,
	"previous_meal"	TEXT,
	"injuries"	boolean,
	"patientId"	INTEGER,
	FOREIGN KEY("patientId") REFERENCES "patients"("id") ON DELETE CASCADE
);
CREATE TABLE IF NOT EXISTS "doctors" (
	"id"	INTEGER PRIMARY KEY AUTOINCREMENT,
	"name"	TEXT NOT NULL,
	"email"	TEXT NOT NULL,
	"hospitalName"	TEXT NOT NULL,
	"photo"	BLOB
);
CREATE TABLE IF NOT EXISTS "episodesymptoms" (
	"episodeId"	INTEGER,
	"symptomId"	INTEGER,
	"severity"	INTEGER NOT NULL,
	PRIMARY KEY("episodeId","symptomId"),
	FOREIGN KEY("episodeId") REFERENCES "episodes"("id") ON DELETE restrict,
	FOREIGN KEY("symptomId") REFERENCES "symptoms"("id") ON DELETE restrict
);
CREATE TABLE IF NOT EXISTS "patientmedication" (
	"patientId"	INTEGER,
	"medicationId"	INTEGER,
	"frequency"	INTEGER NOT NULL,
	"amount"	real NOT NULL,
	FOREIGN KEY("patientId") REFERENCES "patients"("id") ON DELETE restrict,
	FOREIGN KEY("medicationId") REFERENCES "medications"("id") ON DELETE restrict,
	PRIMARY KEY("patientID","medicationID")
);
CREATE TABLE IF NOT EXISTS "symptoms" (
	"id"	INTEGER PRIMARY KEY AUTOINCREMENT,
	"name"	TEXT NOT NULL
);
INSERT INTO "patients" VALUES (1,'Lucia',20,1.7,49.0,'sedentary','lactose free',0,1,NULL,'');
INSERT INTO "patients" VALUES (2,'Jan Kowalski',22,186.0,75.0,NULL,'vegetarian',NULL,NULL,NULL,NULL);
INSERT INTO "patients" VALUES (3,'Jan Kowalski',22,186.0,75.0,NULL,'vegetarian',NULL,NULL,NULL,NULL);
INSERT INTO "medications" VALUES (1,'Ibuprofen');
INSERT INTO "medications" VALUES (2,'Fluoxetina');
INSERT INTO "medications" VALUES (3,'Paracetamol');
INSERT INTO "episodes" VALUES (1,'2022-03-11',2.0,'Having breakfast',NULL,'Home',NULL,NULL,1);
INSERT INTO "episodes" VALUES (2,'2022-02-18',4.0,'running','standard','park','chocolate','yes',NULL);
INSERT INTO "doctors" VALUES (1,'Martin Matin','mmatin@gmail.com','Quiron',NULL);
INSERT INTO "doctors" VALUES (2,'Juan Velezquez','juan.velezquez@gmail.com','Hospital 12 de Octubre',NULL);
INSERT INTO "doctors" VALUES (3,'Juan Velezquez','juan.velezquez@gmail.com','Hospital 12 de Octubre',NULL);
INSERT INTO "doctors" VALUES (4,'Juan Velezquez','juan.velezquez@gmail.com','Hospital 12 de Octubre',NULL);
INSERT INTO "episodesymptoms" VALUES (1,1,5);
INSERT INTO "episodesymptoms" VALUES (1,2,2);
INSERT INTO "patientmedication" VALUES (1,3,2,25.0);
INSERT INTO "symptoms" VALUES (1,'Headache');
INSERT INTO "symptoms" VALUES (2,'Stomache');
COMMIT;
